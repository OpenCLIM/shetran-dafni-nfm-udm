## SHETRAN on DAFNI

SHETran is a model for water flow, solute and sediment transport in river catchments. SHETran is a finite-difference model in which the physics-based governing partial differential equations for flow and transport are solved on a three-dimensional grid. SHETran is a physically-based, spatially-distributed (PBSD) modelling system. The plan area of the catchment in SHETran is usually in the range of one to a few thousand square kilometers and the horizontal depth of the subsurface is usually less than 100m. This DAFNI model runs the Linux version of SHETRAN Prepare (Snow) and SHETRAN using a library file and preprocessed input data.


## Parameters

| name      | title        | description                                                                                                                                                             |
|:----------|:-------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| TITLE     | Title        | The title given to the output dataset in the generated metadata file.                                                                                                   |
| CATCHMENT | Catchment    | The name of the catchment being simulated (e.g. '6007'). Default OpenCLIM catchments are below. This should match filenames of inputs if a user is uploading their own. |
| RCM       | RCM Scenario | The climate scenario of choice. Options are '01', '04', '05', '06', '07', '08', '09', '10', '11', '12', '13', '15').                                                    |
| UDM       | UDM Scenario | The UDM scenario to use. Options are 'baseline' (2017), 'SSP2 2050', 'SSP2 2080', 'SSP4 2050', 'SSP4 2080'.                                                             |
| NFM       | NFM Scenario | The NFM scenario to use. Options are 'none', 'balanced', and 'max'.                                                                                                     |

## Dataslots

| path   | name                | description                                                                                                                                                                                                                                                                                                                                                                                                                     |
|:-------|:--------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| inputs | SHETran input files | A library file must be present with the extension `.xml`. If multiple XML files exist then the alphabetically first file will be used. All input files referenced within the library file must be present. Default data includes UDM and NFM inputs. These are taken from the UDM model and NFM dataset and preprocessed. Users specifying their own uploaded inputs are only required to provide these files if they are used. |

## Outputs

| name                  | description                                                                                                                                                                                                                                                                                                                                                                                       |
|:----------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| outputs/shetran       | SHETRAN output files. All input datasets are included in along with the output files. Input files generated by SHETRAN Prepare are prepended with "input_". Outputs are prepended with "output_". The majority of results are contained in the HDF file, which has the extension `.h5`. Discharge at the outlet is available in text format at either regular timesteps or every model time step. |
| outputs/metadata.json | NID metadata for outputs. This file can be used for creating datasets on DAFNI using the title specified as an input parameter.                                                                                                                                                                                                                                                                   |

## Catchments

The national scale assessment of hydrology used in OpenCLIM reports used outputs from 10's of thousands of simulations. It is not currently practical to run such large numbers of simulations on DAFNI and so much of the processing was done offline. As such, a selection of the UK catchments have been uploaded to enable the user to explore the potential for running SHETRAN using DAFNI - users can also upload their own data in place of the default data used here. 

The following catchments are available:

| NRFA ID  | NRFA Name                        | Area | NSE (HBV) | NSE (SHETRAN) | Comment                                            |
|:---------|:---------------------------------|:-----|:----------|:--------------|:---------------------------------------------------|
| 6007     | Ness at Ness-side                | 1831 | 0.90      | 0.85          | Inverness                                          |
| 19006    | Water of Leith at Murrayfield    | 102  | 0.77      | 0.79          | Flow into Edinburgh                                |
| 23016    | Ouse Burn at Crag Hall           | 52   | 0.64      | 0.81          | Ouseburn, Newcastle upon Tyne                      |
| 27006    | Don at Sheffield Hadfields       | 365  | 0.74      | 0.77          | Sheffield city                                     |
| 27080    | Aire at Oulton Lemonroyd         | 867  | 0.90      | 0.90          | Leeds, Bradford                                    |
| 33039    | Bedford Ouse at Roxton           | 1663 | 0.88      | 0.78          | Milton Keynes                                      |
| 34004    | Wensum at Costessey Mill         | 562  | 0.75      | 0.67          | Wensum at Costessey Mill, North of Norwich         |
| 34005    | Tud at Costessey Park            | 69   | 0.57      | 0.69          | Tud at Costessey Park, West of Norwich             |
| 34006    | Waveney at Needham Mill          | 374  | 0.80      | 0.81          | Waveney at Needham Mill, Broads catchment upstream |
| 39034    | Evenlode at Cassington Mill      | 430  | 0.90      | 0.81          | North-West of Oxford                               |
| 47009    | Tiddy at Tideford                | 39   | 0.93      | 0.85          | Tiddy at Tideford, South-west of England           |
| 48011    | Fowey at Restormel               | 169  | 0.93      | 0.88          | South-west of England                              |
| 53018    | Avon at Bathford                 | 1572 | 0.93      | 0.86          | east of Bath                                       |
| 53028    | By Brook at Middlehill           | 102  | 0.92      | 0.83          | North-east of Bath                                 |
| 54028    | Vyrnwy at Llanymynech            | 779  | 0.89      | 0.87          | Severn, West of Shrewsbury                         |
| 57005    | Taff at Pontypridd               | 453  | 0.87      | 0.88          | Cardiff                                            |
| 62001    | Teifi at Glanteifi               | 898  | 0.92      | 0.82          | West of Wales                                      |
| 67033    | Dee at Chester Suspension Bridge | 1805 | 0.94      | 0.79          | North of Wales                                     |
| 73010    | Leven at Newby Bridge            | 253  | 0.97      | 0.94          | Cumbrian                                           |
| 75003    | Derwent at Ouse Bridge           | 361  | 0.94      | 0.83          | Cumbrian                                           |
| 84013    | Clyde at Daldowie                | 1903 | 0.90      | 0.91          | Glasgow                                            |
| 201006   | Drumragh at Campsie Bridge       | 321  | 0.81      | 0.83          | NI south-west                                      |
| 204001   | Bush at Seneirl Bridge           | 295  | 0.86      | 0.83          | NI north                                           |
| 205011   | Annacloy at Kilmore Bridge       | 187  | 0.93      | 0.82          | NI east                                            |