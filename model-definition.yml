kind: M
api_version: v1beta2
metadata:
  display_name: SHETRAN
  name: shetran
  summary: SHETRAN is a physically-based spatially-distributed hydrological model.
  source_code: https://github.com/OpenCLIM/shetran-dafni
  publisher: Newcastle University
  description: >
    SHETRAN is a model for water flow, solute and sediment transport in river catchments.
    SHETRAN is a finite-difference model in which the physics-based governing partial differential equations for flow and transport are solved on a three-dimensional grid.
    SHETRAN is a physically-based, spatially-distributed (PBSD) modelling system.
    The plan area of the catchment in SHETRAN is usually in the range of one to a few thousand square kilometers and the horizontal depth of the subsurface is usually less than 100m.
    This DAFNI model runs the Linux version of SHETRAN Prepare (Snow) and SHETRAN using a library file and preprocessed input data.
spec:
  inputs:
    dataslots: 
      - name: SHETRAN input files
        description:
          A library file must be present with the extension `.xml`.
          If multiple XML files exist then the alphabetically first file will be used.
          All input files referenced within the library file must be present.
        default:
          - bdb42828-e581-4a1d-8a0a-afcd634d4a2a
        path: inputs
        required: false

    parameters:
      - name: TITLE
        title: Title
        type: string
        description: The title given to the output dataset in the generated metadata file.
        default: Shetran output
        required: false

      - name: CATCHMENT_NAME
        title: Catchment Identifier
        type: string
        description: The name or identifier of the catchment (e.g. '1001'). This should be a section of the name in the catchment input files (e.g. '1001_DEM.asc').
        required: false

      - name: CLIMATE_SCENARIO
        title: Climate RCM
        type: string
        description: The UKCP18 climate scenario / RCM to use for driving data for the simulation.
        default: RCM 01
        required: true
        options:
          - name: RCM 01
            title: 01
          - name: RCM 04
            title: 04
          - name: RCM 05
            title: 05
          - name: RCM 06
            title: 06
          - name: RCM 07
            title: 07
          - name: RCM 08
            title: 08
          - name: RCM 09
            title: 09
          - name: RCM 10
            title: 10
          - name: RCM 11
            title: 11
          - name: RCM 12
            title: 12
          - name: RCM 13
            title: 13
          - name: RCM 15
            title: 15

      - name: NFM_SCENARIO
        title: NFM Scenario
        type: string
        description: The NFM adaptation scenario to simulate.
        default: 'Baseline'
        required: true
        options:
          - name: Baseline
            title: Baseline (No Adaptation)
          - name: max
            title: Maximum Adaptation
          - name: balanced
            title: Balanced Adaptation

      - name: UDM_SCENARIO
        title: UDM Scenario
        type: string
        description: The UDM growth/change scenario to simulate.
        default: 'Baseline'
        required: true
        options:
          - name: Baseline
            title: Baseline (2017)
          - name: SSP2_2050
            title: SSP2_2050
          - name: SSP2_2080
            title: SSP2_2080
          - name: SSP4_2050
            title: SSP4_2050
          - name: SSP4_2080
            title: SSP4_2080

  outputs:
    datasets:
      - name: outputs/shetran
        type: folder
        description:
          SHETRAN output files.
          All input datasets are included in along with the output files.
          Input files generated by SHETRAN Prepare are prepended with "input_".
          Outputs are prepended with "output_".
          The majority of results are contained in the HDF file, which has the extension `.h5`.
          Discharge at the outlet is available in text format at either regular timesteps or every model time step.

      - name: outputs/metadata.json
        type: JSON
        description:
          NID metadata for outputs.
          This file can be used for creating datasets on DAFNI using the title specified as an input parameter.
